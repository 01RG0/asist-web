# Implementation Plan - Calls & WhatsApp Module

## Goal Description
Implement a new module for managing "Calls" and "WhatsApp" activities. This includes:
1.  **Controls Page**: For Admins to schedule WhatsApp shifts (auto-recorded) and create Call sessions.
2.  **Records Page**: For Admins to view and edit the history of these activities.
3.  **Assistant Interface**: For Assistants to manually start and stop "Call" sessions.
4.  **Backend Logic**: To handle scheduling, auto-recording WhatsApp shifts, and tracking Call durations.

## User Review Required
> [!IMPORTANT]
> **Auto-Recording Logic**: For WhatsApp, the system will "auto-record" attendance based on the schedule. This implies that if a user is scheduled from 9am-5pm, the system will automatically generate a record for 9am-5pm without the user needing to "check in".
> **Cron Jobs**: To support "auto-recording", we will implement a mechanism (likely a daily check or a lazy-create on view) to generate these records.

## Proposed Changes

### Backend

#### [NEW] Models
*   `models/WhatsAppSchedule.js`: Stores the configuration for auto-recording (User, Day/Date, StartTime, EndTime, Recurring).
*   `models/CallSession.js`: Defines available call blocks (Name, Date, TimeWindow).
*   `models/ActivityLog.js`: Stores the actual historical records (User, Type ['whatsapp', 'call'], StartTime, EndTime, Duration).

#### [NEW] Controllers & Routes
*   `controllers/activityController.js`: Handles CRUD for Schedules, Sessions, and Logs.
*   `routes/activityRoutes.js`: API endpoints for the frontend.

### Frontend (Admin)

#### [NEW] Pages
*   `frontend/admin/controls.html`: Interface for managing WhatsApp Schedules and Call Sessions.
*   `frontend/admin/records.html`: Interface for viewing and editing Activity Logs.

#### [NEW] Scripts
*   `frontend/admin/js/controls.js`: Logic for the Controls page.
*   `frontend/admin/js/records.js`: Logic for the Records page.

### Frontend (Assistant)

#### [MODIFY] Dashboard/Attendance
*   Add a section for "Active Call Sessions".
*   Add "Start Call" and "End Call" buttons.

## Verification Plan

### Automated Tests
*   Test API endpoints for creating schedules.
*   Test "Auto-record" generation logic.
*   Test Start/End call functionality.

### Manual Verification
1.  **WhatsApp Flow**:
    *   Admin sets a schedule for User A (e.g., Today, 10am-11am).
    *   Verify a record appears in "Records" page (either immediately or after the time passes).
2.  **Calls Flow**:
    *   Admin creates a Call Session.
    *   Assistant logs in and sees the session.
    *   Assistant clicks "Start".
    *   Admin sees "Ongoing" status in Records.
    *   Assistant clicks "End".
    *   Admin sees final duration in Records.
